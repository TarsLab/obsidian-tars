# MCP Integration Execution Tasks

**Generated from:**
- docs/2025-10-03-mcp-integration-review.md
- docs/2025-10-03-115553-planning.md
- docs/2025-10-03-planning-v2.md

**Timestamp:** 2025-10-03-120627
**Total Story Points:** 143
**Status:** Ready for Implementation

---

General Notes:
- Update Tasks document `/docs/2025-10-03-120627-tasks.md` with important notes that influence on how we acomplishing the tasks, so we does not loose the improtant findings
- This is a bad practice approach in code: `if (process.env.NODE_ENV !== 'test') {` instead we should better mock, spy, stub or fake the dependency in our unit tests
- Placeholders in unit tests are not allowed, if we cannot test something it only means that we have to refactor code to make it testable. (exception is only initialization commits, when we need to establish infrustructure of the project.)
- on task done document in `docs/2025-10-03-120627-tasks.md` which unit test confirms specific task done state, if test does not exists - we should create it. 
- use command `OLLAMA_URL=http://localhost:11434 npm run test` to run the tests
- update the checkboxes in `docs/2025-10-03-120627-tasks.md` document when task is done 
- `npm run build` should pass
- all unit tests should be GREEN, otherwise task is not done.
- on task done, prepare git commit with semantic commit message

---

## Epic-100: Critical Bug Fixes (Production Blockers)

**Priority**: P0
**Story Points**: 18
**Status**: Not Started
**Description**: Fix critical bugs preventing MCP functionality. Code investigation confirms issues in managerMCPUse.ts and executor.ts.

### Feature-100-10: Fix Server Initialization

**Priority**: P0
**Story Points**: 3
**Description**: Resolve ID/name mismatch. Code shows mismatch at mcpUseAdapter.ts and managerMCPUse.ts.

#### UserStory-100-10-5: ID/Name Mismatch Resolution

**Priority**: P0
**Story Points**: 3

- [ ] Update mcpUseAdapter to use config.id
- [ ] Update managerMCPUse session creation
- [ ] Add unit tests for ID/name alignment

### Feature-100-20: Enable Configuration Settings

**Priority**: P0
**Story Points**: 3
**Description**: Wire settings to executor. Code in index.ts hardcodes values.

#### UserStory-100-20-5: Wire Timeout Settings

**Priority**: P0
**Story Points**: 3

- [ ] Add regression test for executor options
- [ ] Update createToolExecutor signature
- [ ] Thread settings from main.ts

#### UserStory-100-20-10: Apply Execution Limits

**Priority**: P0
**Story Points**: 1

- [ ] Update executor tracker initialization

### Feature-100-30: Activate Health Monitoring

**Priority**: P0
**Story Points**: 3
**Description**: Start timer. Code defines interval in index.ts but no setInterval.

#### UserStory-100-30-5: Start Health Check Timer

**Priority**: P0
**Story Points**: 3

- [ ] Write timer orchestration test
- [ ] Add setInterval in main.ts onload
- [ ] Clear timer in onunload

### Feature-100-40: Fix Inefficient Tool Discovery (Missed in original, added)

**Priority**: P0 (elevated - performance blocker per review)
**Story Points**: 3
**Description**: Cache mappings. Code in providerAdapters.ts calls async repeatedly.

#### UserStory-100-40-5: Implement Tool Mapping Cache

**Priority**: P0
**Story Points**: 3

- [ ] Add cache storage to provider adapters
- [ ] Use cached mapping in buildTools
- [ ] Invalidate cache on server changes

### Feature-100-50: Fix Memory Leaks

**Priority**: P0
**Story Points**: 3
**Description**: Cleanup errors. Code in executor.ts misses some paths.

#### UserStory-100-50-5: Fix Execution Cleanup

**Priority**: P0
**Story Points**: 3

- [ ] Audit error paths in executor
- [ ] Add cleanup to error handlers
- [ ] Add memory leak detection tests

### Feature-100-90: Release Validation & Sign-Off

**Priority**: P0
**Story Points**: 3
**Description**: Manual checks.

#### UserStory-100-90-5: Human Review & Release Approval

**Priority**: P0
**Story Points**: 3

- [ ] Conduct manual verification and document sign-off

---

## Epic-200: Core Missing Features

**Priority**: P1
**Story Points**: 32
**Status**: Not Started
**Description**: Implement missing core features. Code confirms no Claude adapter in providerAdapters.ts.

### Feature-200-10: Auto-Disable Failed Servers

**Priority**: P1
**Story Points**: 10

#### UserStory-200-10-5: Implement Failure Tracking

**Priority**: P1
**Story Points**: 5

- [ ] Add failure counter regression test
- [ ] Add failureCount to server config
- [ ] Increment on startServer failure
- [ ] Reset on successful start

#### UserStory-200-10-10: Auto-Disable Logic

**Priority**: P1
**Story Points**: 5

- [ ] Check threshold and disable
- [ ] Emit server-auto-disabled event
- [ ] Validate auto-disable flow via Playwright

### Feature-200-20: Claude Provider Integration

**Priority**: P1
**Story Points**: 10

#### UserStory-200-20-5: Create Claude Provider Adapter

**Priority**: P1
**Story Points**: 6

- [ ] Create ClaudeProviderAdapter class
- [ ] Implement buildTools for Claude format
- [ ] Implement formatToolResult for Claude
- [ ] Add ClaudeToolResponseParser

#### UserStory-200-20-10: Integrate into Claude Provider

**Priority**: P1
**Story Points**: 4

- [ ] Update sendRequestFunc signature
- [ ] Route through ToolCallingCoordinator
- [ ] Add unit tests for Claude adapter

### Feature-200-30: Tool Result Persistence

**Priority**: P0 (elevated - critical for transparency per review)
**Story Points**: 8

#### UserStory-200-30-5: Persist Tool Calls in Documents

**Priority**: P1
**Story Points**: 8

- [ ] Add integration test for markdown persistence
- [ ] Modify ToolCallingCoordinator to accept editor
- [ ] Insert tool call markdown format
- [ ] Insert tool result markdown

#### UserStory-200-30-10: Format Tool Results

**Priority**: P1
**Story Points**: 8

- [ ] Design result markdown template
- [ ] Handle different content types
- [ ] Add metadata display

### Feature-200-40: SSE Support via mcp-remote (Added - missed in original)

**Priority**: P1 (critical for remote servers per review)
**Story Points**: 2
**Description**: Add SSE support using mcp-remote bridge. Review suggests this; code in config.ts supports URLs but throws errors.

#### UserStory-200-40-5: Integrate mcp-remote Bridge

**Priority**: P1
**Story Points**: 2

- [ ] Modify toMCPUseFormat for URLs
- [ ] Remove URL validation error

### Feature-200-90: Release Validation & Sign-Off

**Priority**: P1
**Story Points**: 2

#### UserStory-200-90-5: Human Review & Release Approval

**Priority**: P1
**Story Points**: 2

- [ ] Execute manual validation checklist and collect approvals

---

## Epic-300: Performance & Resource Management

**Priority**: P1
**Story Points**: 28
**Status**: Not Started
**Description**: Optimize. Code in executor.ts shows leak risks.

### Feature-300-10: Tool Discovery Caching

**Priority**: P1
**Story Points**: 5

#### UserStory-300-10-5: Cache Tool Server Mappings

**Priority**: P2
**Story Points**: 3

- [ ] Add cache Map to provider adapters
- [ ] Invalidate cache on server changes
- [ ] Add cache metrics

#### UserStory-300-10-10: Optimize Tool Listing

**Priority**: P2
**Story Points**: 2

- [ ] Batch tool listing requests
- [ ] Add lazy initialization option

### Feature-300-20: Memory Leak Prevention

**Priority**: P1
**Story Points**: 3

#### UserStory-300-20-5: Fix Execution Cleanup

**Priority**: P1
**Story Points**: 3

- [ ] Audit error paths in executor
- [ ] Add cleanup to error handlers
- [ ] Add memory leak detection tests

### Feature-300-30: Error Recovery Mechanism

**Priority**: P1
**Story Points**: 8

#### UserStory-300-30-5: Exponential Backoff Retry

**Priority**: P1
**Story Points**: 8

- [ ] Add RetryPolicy configuration
- [ ] Implement exponential backoff
- [ ] Classify transient vs permanent errors
- [ ] Add retry status to UI
- [ ] Add retry/backoff unit tests

### Feature-300-40: Cancellation Support (Added - TODO in code)

**Priority**: P1 (elevated - review notes as missing)
**Story Points**: 10
**Description**: Implement true cancellation. Code has TODO in executor.ts.

#### UserStory-300-40-5: Add Abort Support

**Priority**: P1
**Story Points**: 10

- [ ] Add AbortController to executeTool
- [ ] Implement cancelExecution with abort
- [ ] Add UI cancel button
- [ ] Test cancellation flows

### Feature-300-90: Release Validation & Sign-Off

**Priority**: P1
**Story Points**: 2

#### UserStory-300-90-5: Human Review & Release Approval

**Priority**: P1
**Story Points**: 2

- [ ] Execute manual resilience checklist and record approval

---

## Epic-400: User Experience Enhancements

**Priority**: P2
**Story Points**: 25
**Status**: Not Started
**Description**: Improve UX.

### Feature-400-10: Tool Browser Modal

**Priority**: P2
**Story Points**: 8

#### UserStory-400-10-5: Create Tool Browser UI

**Priority**: P2
**Story Points**: 3

- [ ] Create ToolBrowserModal class
- [ ] Add server filter dropdown
- [ ] Render tool cards

### Feature-400-20: Tool Auto-Completion

**Priority**: P2
**Story Points**: 8

#### UserStory-400-20-5: Tool Name Auto-Complete

**Priority**: P2
**Story Points**: 3

- [ ] Create MCPToolSuggest class
- [ ] Detect code block context
- [ ] Fetch tools for server

#### UserStory-400-20-10: Parameter Auto-Complete

**Priority**: P2
**Story Points**: 5

- [ ] Create MCPParameterSuggest class
- [ ] Parse parameter schema
- [ ] Show parameter metadata
- [ ] Add auto-complete tests

### Feature-400-30: Enhanced Status Display

**Priority**: P2
**Story Points**: 5

#### UserStory-400-30-5: Real-Time Status Updates

**Priority**: P2
**Story Points**: 3

- [ ] Listen to manager events
- [ ] Add execution count to status
- [ ] Add error indicators

#### UserStory-400-30-10: Enhanced Status Modal

**Priority**: P2
**Story Points**: 2

- [ ] Add execution statistics
- [ ] Add refresh button

### Feature-400-40: Templated Inserts (Added - improves UX)

**Priority**: P2
**Story Points**: 2
**Description**: Add command for inserting tool templates.

#### UserStory-400-40-5: Implement Templated Insert Command

**Priority**: P2
**Story Points**: 2

- [ ] Add "Insert MCP Tool Call" command
- [ ] Generate parameter placeholders

### Feature-400-90: Release Validation & Sign-Off

**Priority**: P2
**Story Points**: 2

#### UserStory-400-90-5: Human Review & Release Approval

**Priority**: P2
**Story Points**: 2

- [ ] Run UX smoke test script and record feedback

---

## Epic-500: Advanced Features

**Priority**: P2 (elevated - parallel is important for UX)
**Story Points**: 25
**Status**: Not Started
**Description**: Advanced features.

### Feature-500-10: Parallel Tool Execution

**Priority**: P2 (elevated)
**Story Points**: 10

#### UserStory-500-10-5: Implement Parallel Execution

**Priority**: P2
**Story Points**: 5

- [ ] Add parallel execution mode to coordinator
- [ ] Add execution synchronization
- [ ] Handle partial failures

#### UserStory-500-10-10: Configuration & Safety

**Priority**: P2
**Story Points**: 5

- [ ] Add parallelExecution setting
- [ ] Add max parallel limit
- [ ] Add parallel execution tests

### Feature-500-20: Tool Result Caching

**Priority**: P3
**Story Points**: 8

#### UserStory-500-20-5: Implement Result Cache

**Priority**: P3
**Story Points**: 5

- [ ] Create ResultCache class
- [ ] Check cache before execution
- [ ] Store results with TTL
- [ ] Add cache invalidation

#### UserStory-500-20-10: Cache UI Integration

**Priority**: P3
**Story Points**: 3

- [ ] Add cache indicator to results
- [ ] Add cache management command
- [ ] Add cache statistics

### Feature-500-30: Execution History Viewer

**Priority**: P3
**Story Points**: 5

#### UserStory-500-30-5: Build History UI

**Priority**: P3
**Story Points**: 5

- [ ] Create ExecutionHistoryModal
- [ ] Add filters and search
- [ ] Add detail view

### Feature-500-90: Release Validation & Sign-Off

**Priority**: P3
**Story Points**: 2

#### UserStory-500-90-5: Human Review & Release Approval

**Priority**: P3
**Story Points**: 2

- [ ] Run advanced feature validation script and document approval

---

## Epic-600: Testing Infrastructure

**Priority**: P3
**Story Points**: 15
**Status**: Not Started
**Description**: Improve testing.

### Feature-600-10: UI Testing Strategy

**Priority**: P3
**Story Points**: 8

#### UserStory-600-10-5: Extract Testable UI Logic

**Priority**: P3
**Story Points**: 5

- [ ] Extract status formatting functions
- [ ] Extract HTML generation functions
- [ ] Add unit tests for UI logic

#### UserStory-600-10-10: Playwright E2E Setup

**Priority**: P3
**Story Points**: 3

- [ ] Install and configure Playwright
- [ ] Create test vault setup script
- [ ] Write sample E2E test

### Feature-600-20: Coverage Improvements

**Priority**: P3
**Story Points**: 5

#### UserStory-600-20-5: Missing Test Coverage

**Priority**: P3
**Story Points**: 5

- [ ] Add timeout handling tests
- [ ] Add health check tests
- [ ] Add error scenario tests
- [ ] Add SSE support tests

### Feature-600-90: Release Validation & Sign-Off

**Priority**: P3
**Story Points**: 2

#### UserStory-600-90-5: Human Review & Release Approval

**Priority**: P3
**Story Points**: 2

- [ ] Verify test tooling updates and capture approval

---

## Summary & Timeline

**Total Story Points**: 143
**Estimated Timeline**: 7-9 weeks
**Phases**:
- Phase 1: Stabilization (P0) - Week 1
- Phase 2: Core Completeness (P1) - Weeks 2-3
- Phase 3: Resilience & Optimization (P1) - Weeks 3-4
- Phase 4: User Experience (P2) - Weeks 4-5
- Phase 5: Advanced Features (P3) - Week 6
- Phase 6: Quality Assurance (P3) - Week 6