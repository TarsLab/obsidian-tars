# MCP Integration Execution Tasks (Trimmed)

**Generated from:** `docs/2025-10-03-120627-tasks.md`, `docs/2025-10-03-115553-planning.md`
**Timestamp:** 2025-10-07-075907 (Last updated: 2025-10-10 with Epic-1000)
**Purpose:** Track only unimplemented backlog items while keeping original structure and planning context.

---

## üìã Remaining Work Summary
- **Total Remaining Story Points**: 72 SP (64 SP from original + 8 SP from Epic-1000)
- **Completed Since Last Update**: Epic-500-10 (Parallel Tool Execution) - 10 SP ‚úÖ
- **Epics In Scope**: Epic-1000 (stabilization), Epic-500 (partial), Epic-600, Epic-700 (validation only), Epic-900 (partial)
- **New Addition**: Epic-1000 added for stabilization phase with LLM provider connection testing
- **Blocking Dependencies**: Complete prior epics remain prerequisites (`Epic-100`‚Äì`Epic-400`)

---

## Epic-500: Advanced Features

**Priority**: P2 (elevated)
**Story Points**: 25
**Status**: IN PROGRESS (10/25 SP Complete)
**Description**: Parallel execution, result caching, history UI, and associated validation.

### Feature-500-10: Parallel Tool Execution ‚úÖ

**Priority**: P2 (elevated)
**Story Points**: 10
**Status**: ‚úÖ COMPLETE (2025-10-10)
**Description**: Execute multiple tool calls concurrently with safety controls using p-limit library for concurrency management.

#### UserStory-500-10-5: Implement Parallel Execution ‚úÖ

**Story Points**: 5
**Status**: ‚úÖ COMPLETE (2025-10-10)
**Description**: Provide coordinator/executor changes for concurrent tool runs.

- [x] **Task-500-10-5-1: Add parallel execution mode to coordinator ‚úÖ**
  - **Files**: `src/mcp/toolCallingCoordinator.ts`
  - **Implementation**: Used p-limit library for concurrency control; parallel execution controlled by `maxParallelTools` parameter (defaults to 1 for sequential, 3 for parallel).
  - **Status**: ‚úÖ Completed 2025-10-10 ‚Äî commit 2c1cac5, simplified with commit 1ca8f47

- [x] **Task-500-10-5-2: Add execution synchronization ‚úÖ**
  - **Files**: `src/mcp/toolCallingCoordinator.ts`
  - **Implementation**: p-limit ensures thread-safe concurrent execution with proper limit enforcement.
  - **Status**: ‚úÖ Completed 2025-10-10 ‚Äî commit 2c1cac5

- [x] **Task-500-10-5-3: Handle partial failures ‚úÖ**
  - **Files**: `src/mcp/toolCallingCoordinator.ts`
  - **Implementation**: Promise.all() handles partial failures; errors logged to status bar; successful results preserved.
  - **Status**: ‚úÖ Completed 2025-10-10 ‚Äî commit 2c1cac5

#### UserStory-500-10-10: Configuration & Safety ‚úÖ

**Story Points**: 5
**Status**: ‚úÖ COMPLETE (2025-10-10)
**Description**: Expose settings and tests that keep parallel mode controlled.

- [x] **Task-500-10-10-1: Add parallelExecution setting ‚úÖ**
  - **Files**: `src/settings.ts`, `src/settings/MCPServerSettings.ts`
  - **Implementation**: Toggle added to settings UI; defaults to `false`; persists user preference.
  - **Status**: ‚úÖ Completed 2025-10-10 ‚Äî commit bf6f1fc

- [x] **Task-500-10-10-2: Add max parallel limit ‚úÖ**
  - **Files**: `src/settings.ts`, `src/settings/MCPServerSettings.ts`
  - **Implementation**: Text input for `mcpMaxParallelTools` (default: 3); wired through all providers.
  - **Status**: ‚úÖ Completed 2025-10-10 ‚Äî commit bf6f1fc

- [x] **Task-500-10-10-3: Add parallel execution tests ‚úÖ**
  - **Files**: `tests/mcp/toolCallingCoordinator.test.ts`
  - **Implementation**: 5 comprehensive tests covering sequential mode, parallel mode, concurrency limits, partial failures, and fallback to sequential.
  - **Status**: ‚úÖ Completed 2025-10-10 ‚Äî commit 84e125c; 337 tests passing

### Feature-500-20: Tool Result Caching

**Priority**: P3
**Story Points**: 8
**Description**: Cache tool outputs to avoid redundant executions (`src/mcp/resultCache.ts`, `src/mcp/executor.ts`, `src/settingTab.ts`).

#### UserStory-500-20-5: Implement Result Cache

**Story Points**: 5
**Description**: Introduce cache lifecycle.

- [ ] **Task-500-20-5-1: Create ResultCache class**
  - **Files**: `src/mcp/resultCache.ts`
  - **Planning Notes**: Implement hashing via SHA-256 over server ID, tool name, parameters.
  - **Acceptance Criteria**: Cache stores and retrieves deterministic entries keyed by parameter hash.

- [ ] **Task-500-20-5-2: Check cache before execution**
  - **Files**: `src/mcp/executor.ts`
  - **Planning Notes**: Short-circuit execution when cached response present; annotate response as cached.
  - **Acceptance Criteria**: Cached hits return without invoking tool server.

- [ ] **Task-500-20-5-3: Store results with TTL**
  - **Files**: `src/mcp/executor.ts`
  - **Planning Notes**: Default TTL 5 minutes; include timestamp metadata.
  - **Acceptance Criteria**: Successful executions populate cache with expiry logic honored on retrieval.

- [ ] **Task-500-20-5-4: Add cache invalidation**
  - **Files**: `src/mcp/resultCache.ts`
  - **Planning Notes**: Support TTL purge, manual clear, and server restart invalidation.
  - **Acceptance Criteria**: Stale entries removed automatically; manual/API invalidation clears targeted scopes.

#### UserStory-500-20-10: Cache UI Integration

**Story Points**: 3
**Description**: Surface cache state to users.

- [ ] **Task-500-20-10-1: Add cache indicator to results**
  - **Files**: `src/mcp/toolCallingCoordinator.ts`
  - **Planning Notes**: Annotate markdown with `üì¶ Cached (age)` metadata when applicable.
  - **Acceptance Criteria**: Documents clearly differentiate cached vs fresh outputs.

- [ ] **Task-500-20-10-2: Add cache management command**
  - **Files**: `src/main.ts`
  - **Planning Notes**: Register "Clear MCP Tool Result Cache" command invoking executor cache clear.
  - **Acceptance Criteria**: Command palette action purges cache and confirms via Notice.

- [ ] **Task-500-20-10-3: Add cache statistics**
  - **Files**: `src/modals/mcpStatusModal.ts`
  - **Planning Notes**: Display hit rate, size, entry count, oldest age.
  - **Acceptance Criteria**: Status modal exposes real-time cache metrics from executor.

### Feature-500-30: Execution History Viewer

**Priority**: P3
**Story Points**: 5
**Description**: Provide modal to inspect prior tool executions (`src/modals/executionHistoryModal.ts`, `src/main.ts`).

#### UserStory-500-30-5: Build History UI

**Story Points**: 5
**Description**: Create searchable execution history interface.

- [ ] **Task-500-30-5-1: Create ExecutionHistoryModal**
  - **Files**: `src/modals/executionHistoryModal.ts`
  - **Planning Notes**: Table with timestamp, server, tool, status, duration, actions.
  - **Acceptance Criteria**: Modal lists executions sorted by time.

- [ ] **Task-500-30-5-2: Add filters and search**
  - **Files**: `src/modals/executionHistoryModal.ts`
  - **Planning Notes**: Filters by server, tool, status, date range; real-time updates.
  - **Acceptance Criteria**: Filtering narrows results without refresh.

- [ ] **Task-500-30-5-3: Add detail view**
  - **Files**: `src/modals/executionHistoryModal.ts`
  - **Planning Notes**: Expand row details with parameters, result, metadata, errors.
  - **Acceptance Criteria**: Users can inspect full execution payload.

### Feature-500-90: Release Validation & Sign-Off

**Priority**: P3
**Story Points**: 2
**Description**: Manual approval for advanced features (`docs/release-notes.md`, `tests/manual/mcp-advanced-validation.md`).

#### UserStory-500-90-5: Human Review & Release Approval

- [ ] **Task-500-90-5-1: Run advanced feature validation script and document approval**
  - **Planning Notes**: Execute manual script covering parallel execution, caching, history viewer; capture evidence in release notes.
  - **Acceptance Criteria**: Release documentation includes reviewer sign-off and artifacts.

---

## Epic-600: Testing Infrastructure

**Priority**: P3
**Story Points**: 15
**Status**: Not Started
**Description**: Strengthen UI/unit/E2E coverage and tooling.

### Feature-600-10: UI Testing Strategy

**Priority**: P3
**Story Points**: 8
**Description**: Make UI logic testable without full Obsidian runtime (`src/statusBarManager.ts`, `src/modals/mcpStatusModal.ts`, `tests/ui/`).

#### UserStory-600-10-5: Extract Testable UI Logic

**Story Points**: 5
**Description**: Refactor UI formatting into pure functions.

- [ ] **Task-600-10-5-1: Extract status formatting functions**
  - **Files**: `src/statusBarManager.ts`, `src/utils/statusFormatting.ts`
  - **Planning Notes**: Move status string builders into utility module for testing.
  - **Acceptance Criteria**: Formatting logic becomes pure functions with unit tests available.

- [ ] **Task-600-10-5-2: Extract HTML generation functions**
  - **Files**: `src/modals/mcpStatusModal.ts`, `src/utils/htmlBuilders.ts`
  - **Planning Notes**: Generate HTML strings separately from DOM manipulation.
  - **Acceptance Criteria**: Modal rendering consumes reusable builders enabling headless tests.

- [ ] **Task-600-10-5-3: Add unit tests for UI logic**
  - **Files**: `tests/ui/statusFormatting.test.ts`
  - **Planning Notes**: Cover formatting/HTML builders for varied scenarios.
  - **Acceptance Criteria**: Tests verify UI logic across edge cases (no servers, failures, etc.).

#### UserStory-600-10-10: Playwright E2E Setup

**Story Points**: 3
**Description**: Establish UI automation baseline.

- [ ] **Task-600-10-10-1: Install and configure Playwright**
  - **Files**: `package.json`, `playwright.config.ts`
  - **Planning Notes**: Add `@playwright/test`, configure custom protocol base URL.
  - **Acceptance Criteria**: Playwright test runner executes against Obsidian vault context.

- [ ] **Task-600-10-10-2: Create test vault setup script**
  - **Files**: `scripts/setup-test-vault.sh`
  - **Planning Notes**: Automate vault creation, plugin install, sample data seeding.
  - **Acceptance Criteria**: Script provisions vault ready for E2E tests.

- [ ] **Task-600-10-10-3: Write sample E2E test**
  - **Files**: `tests/e2e-ui/mcp-settings.spec.ts`
  - **Planning Notes**: Validate MCP settings UI visibility as smoke test.
  - **Acceptance Criteria**: Baseline Playwright test passes in CI.

### Feature-600-20: Coverage Improvements

**Priority**: P3
**Story Points**: 5
**Description**: Add missing scenario tests across suites.

#### UserStory-600-20-5: Missing Test Coverage

- [ ] **Task-600-20-5-1: Add timeout handling tests**
  - **Files**: `tests/mcp/executor.test.ts`
  - **Planning Notes**: Simulate timeout exceed, assert cleanup of `activeExecutions`.
  - **Acceptance Criteria**: Tests prove timeout errors are surfaced and resources cleaned.

- [ ] **Task-600-20-5-3: Add health check tests**
  - **Files**: `tests/mcp/managerMCPUse.test.ts`
  - **Planning Notes**: Validate periodic health state updates and persistence.
  - **Acceptance Criteria**: Health map accurately reflects server states across runs.

- [ ] **Task-600-20-5-4: Add error scenario tests**
  - **Files**: `tests/mcp/errorHandling.test.ts`
  - **Planning Notes**: Cover server start failure, tool errors, network timeouts, invalid parameters, disconnects.
  - **Acceptance Criteria**: Error paths are exhaustively tested with assertions on logging and recovery.

### Feature-600-90: Release Validation & Sign-Off

**Priority**: P3
**Story Points**: 2

#### UserStory-600-90-5: Human Review & Release Approval

- [ ] **Task-600-90-5-1: Verify test tooling updates and capture approval**
  - **Planning Notes**: Run UI, integration, and Playwright suites; document outcomes in release notes with reviewer initials.
  - **Acceptance Criteria**: Manual validation evidence stored in `docs/release-notes.md` and supporting manual test doc.

---

## Epic-700: Settings UI Improvements (Validation Pending)

**Priority**: P2
**Story Points**: 0 (validation only)
**Status**: Pending Sign-Off
**Description**: Functional work complete; remaining task is manual validation.

### Feature-700-90: Release Validation & Sign-Off

**Priority**: P2
**Story Points**: 0

#### UserStory-700-90-5: Human Review & Release Approval

- [ ] **Task-700-90-5-1: Manual UI testing for config toggle**
  - **Acceptance Criteria**: Manual walkthrough confirms config display toggle behavior and documents evidence.

- [ ] **Task-700-90-5-2: Verify settings persistence**
  - **Acceptance Criteria**: Persistence of settings changes verified and recorded.

- [ ] **Task-700-90-5-3: Document sign-off**
  - **Acceptance Criteria**: Release notes updated with reviewer approval for Epic-700.

---

## Epic-900: Document-Scoped Sessions & Enhanced UX

**Priority**: P1
**Story Points**: 31
**Status**: Not Started
**Description**: Document-aware session lifecycle, smart caching, enhanced settings/status UX.

### Feature-900-10: Document-Scoped Session Management ‚úÖ

**Priority**: P1
**Story Points**: 8
**Description**: Track and reset session counts per document (`src/mcp/executor.ts`, `src/main.ts`).

#### UserStory-900-10-5: Per-Document Session Tracking ‚úÖ

- [x] **Task-900-10-5-1: Add document-scoped session tracker** ‚úÖ
  - **Files**: `src/mcp/executor.ts`
  - **Planning Notes**: Maintain `documentSessions` map with total count across all servers, reset logic, notifications.
  - **Acceptance Criteria**: Each document maintains independent totals; resets occur on document reopen with user notice.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî validated via `tests/integration/toolExecution.test.ts`, `tests/e2e/documentToolFlow.test.ts`, `npm run test`

- [x] **Task-900-10-5-2: Detect document switch and update context** ‚úÖ
  - **Files**: `src/main.ts`, `src/mcp/documentSessionHandlers.ts`
  - **Planning Notes**: Hook `active-leaf-change` and `vault.delete` events to manage executor context.
  - **Acceptance Criteria**: Switching files updates executor context while preserving previous document state.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî enforced via `src/mcp/documentSessionHandlers.ts`, validated by `tests/integration/documentSessionHandlers.test.ts`, `npm run test`

- [x] **Task-900-10-5-3: Add session reset notification UI** ‚úÖ
  - **Files**: `src/mcp/executor.ts`, `src/main.ts`
  - **Planning Notes**: Implement `Notice` prompting when limit reached and when counter resets on reopen.
  - **Acceptance Criteria**: User can continue or cancel on limit reached; reopen notice informs of reset.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî covered by `tests/integration/toolExecution.test.ts`, `npm run test`

- [x] **Task-900-10-5-4: Add tests for document-scoped sessions** ‚úÖ
  - **Files**: `tests/mcp/executor.test.ts`
  - **Planning Notes**: Validate per-document counts, resets, cleanup.
  - **Acceptance Criteria**: Automated tests cover scenarios from planning Q&A.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `tests/mcp/executor.test.ts`, `npm run test`

### Feature-900-20: Smart Tool Result Caching ‚úÖ

**Priority**: P1
**Story Points**: 5
**Description**: Reuse results already embedded in document (`src/mcp/toolResultCache.ts`, `src/mcp/toolCallingCoordinator.ts`, `src/codeBlockProcessor.ts`).

#### UserStory-900-20-5: Detect Existing Tool Results ‚úÖ

- [x] **Task-900-20-5-1: Create tool result cache parser** ‚úÖ
  - **Files**: `src/mcp/toolResultCache.ts`
  - **Planning Notes**: Parse markdown to locate prior tool results, hash parameters order-independently.
  - **Acceptance Criteria**: Matching block retrieved with location and metadata when parameters align ignoring order.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `tests/mcp/toolResultCache.test.ts`, `npm run test`

- [x] **Task-900-20-5-2: Add re-execution confirmation UI** ‚úÖ
  - **Files**: `src/mcp/toolCallingCoordinator.ts`
  - **Planning Notes**: Provide Notice with choices "Re-execute", "Use Cached", "Cancel" including age.
  - **Acceptance Criteria**: Manual triggers prompt user; default callouts emphasize cached reuse.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `tests/mcp/toolCallingCoordinator.integration.test.ts`, `npm run test`

- [x] **Task-900-20-5-3: Integrate cache detection in coordinator** ‚úÖ
  - **Files**: `src/mcp/toolCallingCoordinator.ts`
  - **Planning Notes**: Check cache before execution; respect `options.promptForCache` for LLM vs manual flows.
  - **Acceptance Criteria**: LLM flows can auto-use cache; manual flows require user confirmation; cancellations abort gracefully.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `tests/mcp/toolCallingCoordinator.integration.test.ts`, `npm run test`

### Feature-900-30: Collapsible Settings Sections ‚úÖ

**Priority**: P2
**Story Points**: 5
**Description**: Persist expanded/collapsed state for settings (`src/settingTab.ts`, `src/settings.ts`, `styles.css`).

#### UserStory-900-30-5: Persistent Section State ‚úÖ

- [x] **Task-900-30-5-1: Add UI state to settings schema** ‚úÖ
  - **Files**: `src/settings.ts`
  - **Planning Notes**: Add `uiState` with defaults for `mcpServersExpanded`, `systemMessageExpanded`.
  - **Acceptance Criteria**: Stored state defaults to collapsed and persists across sessions.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `npm run test`

- [x] **Task-900-30-5-2: Implement collapsible MCP Servers section** ‚úÖ
  - **Files**: `src/settingTab.ts`
  - **Planning Notes**: Use `<details>/<summary>` wrapping existing content; persist toggles on every change.
  - **Acceptance Criteria**: Section collapses by default, remembers state even without content edits.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `styles.css`, `npm run test`

- [x] **Task-900-30-5-3: Implement collapsible System Message section** ‚úÖ
  - **Files**: `src/settingTab.ts`
  - **Planning Notes**: Mirror MCP section behavior with persistence.
  - **Acceptance Criteria**: System message collapsible and stateful as per planning requirement.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `styles.css`, `npm run test`

- [x] **Task-900-30-5-4: Add CSS styling for collapsible sections** ‚úÖ
  - **Files**: `styles.css`
  - **Planning Notes**: Custom arrow indicators, hover feedback, consistent spacing.
  - **Acceptance Criteria**: Visual affordances meet design notes; arrow rotates on expand.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `npm run test`

### Feature-900-40: Enhanced Display Mode Toggle

**Priority**: P2
**Story Points**: 8
**Description**: Smart conversions between URL/JSON/Shell formats (`src/settingTab.ts`, `src/mcp/displayMode.ts`, `src/mcp/mcpUseAdapter.ts`).

#### UserStory-900-40-5: Smart Conversion Modes ‚úÖ

- [x] **Task-900-40-5-1: Create conversion capability detector** ‚úÖ
  - **Files**: `src/mcp/displayMode.ts`
  - **Planning Notes**: Detect format, determine convertible targets, identify mcp-remote compatibility.
  - **Acceptance Criteria**: Capability object accurately reflects permissible conversions and flags.
  - **Status**: ‚úÖ Completed 2025-10-09 ‚Äî `tests/mcp/displayModeToggle.test.ts`, `npm run test`

- [x] **Task-900-40-5-2: Update toggle UI with smart labels** ‚úÖ
  - **Files**: `src/settingTab.ts`
  - **Planning Notes**: Button cycles among supported formats with contextual labels/tooltips.
  - **Acceptance Criteria**: Toggle only offers valid conversions and communicates options clearly.
  - **Status**: ‚úÖ Completed (commit 0af2439) ‚Äî verified in `src/settings/MCPServerSettings.ts:643-656`

- [x] **Task-900-40-5-3: Add conversion validation tests** ‚úÖ
  - **Files**: `tests/mcp/displayMode.test.ts`
  - **Planning Notes**: Cover URL‚ÜíShell, mcp-remote JSON‚ÜíURL/Shell, stdio JSON restrictions, Shell-only scenarios.
  - **Acceptance Criteria**: Unit tests guard against invalid conversions.
  - **Status**: ‚úÖ Completed ‚Äî verified in `tests/mcp/displayModeToggle.test.ts`

### Feature-900-50: Enhanced Status Bar Modal ‚úÖ

**Priority**: P1
**Story Points**: 3
**Description**: Display per-document session totals and improved refresh workflow (`src/statusBarManager.ts`, `src/modals/mcpStatusModal.ts`).

#### UserStory-900-50-5: Session Count Display & Server Refresh ‚úÖ

- [x] **Task-900-50-5-1: Add session count display to status modal** ‚úÖ
  - **Files**: `src/statusBarManager.ts`
  - **Planning Notes**: Show "Document Sessions: X/Y" with warning thresholds based on planning Q&A.
  - **Acceptance Criteria**: UI reflects total sessions per document and warning/alert icons at 80% and 100%.
  - **Status**: ‚úÖ Completed 2025-10-10 ‚Äî Session count with üìä/‚ö†Ô∏è/üî¥ indicators, commit d24bb97

- [x] **Task-900-50-5-2: Implement graceful server restart with UI feedback** ‚úÖ
  - **Files**: `src/statusBarManager.ts`, `src/main.ts`, `styles.css`
  - **Planning Notes**: Multi-phase status indicator (Stopping ‚Üí Waiting ‚Üí Starting ‚Üí Complete), 500ms delay, graceful shutdown with fallback force kill, resets current document sessions only.
  - **Acceptance Criteria**: Refresh flow updates UI per phase, respects timing, resets per-document session count, and handles errors gracefully.
  - **Status**: ‚úÖ Completed 2025-10-10 ‚Äî Multi-phase restart with ‚è∏Ô∏è‚è≥‚ñ∂Ô∏èüîÑ‚úÖ indicators

### Feature-900-60: Auto-Generate Tool Parameters

**Priority**: P2
**Story Points**: 3
**Description**: Standardize parameter placeholders on insert (`src/modals/toolBrowserModal.ts`, `src/suggests/mcpToolSuggestHelpers.ts`).

#### UserStory-900-60-5: Parameter Template Insertion

- [ ] **Task-900-60-5-1: Verify existing template generation**
  - **Files**: `src/modals/toolBrowserModal.ts`
  - **Planning Notes**: Ensure types map to placeholders: `""`, `0`, `false`, `[]`, `{}` with optional example comments.
  - **Acceptance Criteria**: Templates insert correct default values per planning Q10.

- [ ] **Task-900-60-5-2: Add cursor positioning after insert**
  - **Files**: `src/modals/toolBrowserModal.ts`
  - **Planning Notes**: Place caret at first required parameter value post-insert.
  - **Acceptance Criteria**: Editor cursor lands on first editable parameter automatically.

- [ ] **Task-900-60-5-3: Add test for parameter generation**
  - **Files**: `tests/mcp/toolBrowserModal.test.ts`
  - **Planning Notes**: Validate placeholder types, optional markers, cursor positioning.
  - **Acceptance Criteria**: Test suite confirms template correctness and cursor behavior.

### Feature-900-70: Unified Tool Result Formatting

**Priority**: P2
**Story Points**: 2
**Description**: Share formatter between LLM and manual executions (`src/mcp/toolResultFormatter.ts`, `src/mcp/toolCallingCoordinator.ts`, `src/codeBlockProcessor.ts`).

#### UserStory-900-70-5: Consistent Tool Result Format

- [ ] **Task-900-70-5-1: Extract shared formatting function**
  - **Files**: `src/mcp/toolResultFormatter.ts`
  - **Planning Notes**: Provide exported `formatToolResult()` with corrected "Duration: Xms, Type: Y" spacing and collapsible support.
  - **Acceptance Criteria**: Formatter outputs consistent markdown with optional collapsible sections.

- [ ] **Task-900-70-5-2: Update coordinator and processor to use shared formatter**
  - **Files**: `src/mcp/toolCallingCoordinator.ts`, `src/codeBlockProcessor.ts`
  - **Planning Notes**: Replace inline formatting usage with shared helper.
  - **Acceptance Criteria**: All tool result insertions share identical format across execution paths.

---

## Epic-1000: Stabilization & Quality Improvements

**Priority**: P1
**Story Points**: 8
**Status**: Not Started
**Description**: Stabilize current implementation with UX improvements for AI provider configuration and validation.

### Feature-1000-10: LLM Provider Connection Testing

**Priority**: P1
**Story Points**: 5
**Description**: Add "Test connection" button for AI providers with intelligent fallback strategies (`src/settingTab.ts`, `src/providers/utils.ts`).

#### UserStory-1000-10-5: Provider Connection Validation

**Story Points**: 5
**Description**: Implement connection testing with model listing as primary validation and ping/echo as fallback.

- [ ] **Task-1000-10-5-1: Create provider test connection utility**
  - **Files**: `src/providers/utils.ts`
  - **Planning Notes**: Implement `testProviderConnection(vendor, options)` with two-tier strategy:
    - **Primary**: Request available models list (works for most providers)
    - **Fallback**: Send minimal ping/echo/hello message with streaming disabled
  - **Test Strategy**:
    ```typescript
    // Tier 1: Try to list models (most providers support this)
    async function testConnectionViaModels(vendor, options): Promise<TestResult>

    // Tier 2: Fallback to minimal chat completion
    async function testConnectionViaEcho(vendor, options): Promise<TestResult>

    interface TestResult {
      success: boolean
      message: string
      models?: string[] // If successfully retrieved
      latency?: number
    }
    ```
  - **Acceptance Criteria**:
    - Function attempts model listing first
    - Falls back to echo test if model listing fails
    - Returns clear success/failure with helpful error messages
    - Includes connection latency measurement

- [ ] **Task-1000-10-5-2: Add test button to provider settings UI**
  - **Files**: `src/settingTab.ts`
  - **Planning Notes**: Add "Test" button in `createProviderSetting()` next to model selector, similar to MCP server test button pattern.
  - **UI Flow**:
    - Button shows "Testing..." during execution
    - Disable button while testing
    - Success: "‚úÖ Connected! X models available" or "‚úÖ Connected! (Yms latency)"
    - Error: "‚ùå Test failed: {error message}" with helpful hints
  - **Acceptance Criteria**:
    - Test button integrated into each provider settings section
    - Loading state prevents multiple concurrent tests
    - Clear visual feedback for success/failure
    - Helpful error messages guide troubleshooting

- [ ] **Task-1000-10-5-3: Add provider-specific test implementations**
  - **Files**: `src/providers/claude.ts`, `src/providers/openAI.ts`, `src/providers/ollama.ts`, etc.
  - **Planning Notes**:
    - OpenAI/compatible: Use `/v1/models` endpoint
    - Claude: Use minimal message with `max_tokens: 1`
    - Ollama: Use `/api/tags` endpoint
    - Others: Default to echo strategy
  - **Acceptance Criteria**:
    - Each major provider has optimized test path
    - All providers fall back gracefully
    - Test completes in <5 seconds or times out with clear message

- [ ] **Task-1000-10-5-4: Add connection test unit tests**
  - **Files**: `tests/providers/connectionTest.test.ts`
  - **Planning Notes**: Mock HTTP responses for model listing and echo tests, verify fallback behavior.
  - **Acceptance Criteria**:
    - Tests cover successful model listing
    - Tests cover fallback to echo
    - Tests cover timeout scenarios
    - Tests cover invalid credentials

### Feature-1000-90: Release Validation & Sign-Off

**Priority**: P1
**Story Points**: 1

#### UserStory-1000-90-5: Human Review & Release Approval

- [ ] **Task-1000-90-5-1: Manual validation of provider test connections**
  - **Planning Notes**: Test connection button with multiple providers (OpenAI, Claude, Ollama), verify error messages are helpful, document in release notes.
  - **Acceptance Criteria**: Manual walkthrough confirms test button functionality across different provider types.

---

## üéØ Next Steps (Priority Order)
- **Epic-1000 (P1, 8 SP)**: Stabilization phase - implement LLM provider connection testing for better UX
- **Epic-900 (P1, 31 SP)**: Continue with remaining document-scoped sessions and UX enhancements (partial complete)
- **Epic-500 (P2, 15 SP remaining)**: ‚úÖ Parallel execution complete; remaining: result caching (8 SP) and execution history viewer (5 SP)
- **Epic-600 (P3, 15 SP)**: Establish UI/E2E testing foundations and coverage improvements
- **Epic-700 Validation (P2)**: Obtain manual sign-off to fully close settings UI work
